<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <title>FurnStock</title>
</head>
<body>
     <header>
        <p>Ships to: <img src="https://img.icons8.com/external-justicon-flat-justicon/1x/external-india-flag-countrys-flags-justicon-flat-justicon.png" alt="flag"> India </p>
    </header>
    <nav id="nav" class="navbar navbar-expand-lg navbar bg-primary shadow sticky-top">
        <div class="container-fluid">
         
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <a class="navbar-brand" href="./index.html"><img id="image" src="./image/FurnStock.png" alt="FurnStock"  width="50" height="54"></a>
          <form class="d-flex" role="search" id="search"  style="border-color: blue;">
            <input class="form-control me-2" type="search" style="background-color: rgb(227, 227, 227);" placeholder="Search...everything you find ships for free" aria-label="Search">
            <button class="btn btn-outline-danger" style="background-color: red;color: white;" type="submit">Search</button>
          </form>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
          
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="./registration.html"><img src="https://img.icons8.com/ios/1x/user.png" alt="person" height="24" id="login"></a>
              </li>
              <li class="nav-item">
                <button style="margin-top: 2%;display: none; color: white; background-color: transparent; border-color: white;" id="logout">logout</button>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./"><img src="https://img.icons8.com/ios/256/hearts--v1.png" alt="wish" height="24"></a>
              </li>
             
              <li class="nav-item">
                <a class="nav-link" href="./cart.html"><img src="https://img.icons8.com/fluency-systems-regular/1x/shopping-cart.png" alt="cart"></a>
              </li>
              <li id="new1" class="nav-item">
                <a class="nav-link" href="./furnitre.html">Furnitre</a>
              </li>
              <li id="new2" class="nav-item" >
                <a class="nav-link" href="./decor.html">Decor</a>
              </li>
              <li id="new3" class="nav-item" >
                <a class="nav-link" href="./outdoor.html">Outdoor</a>
              </li>
              
              
            </ul>
          
          </div>
        </div>
      </nav>
      <div class="bar">
        <a href="./furnitre.html">Furnitre</a>
        <a href="./outdoor.html">Outdoor</a>
        <a href="./rugs.html">Rugs</a>
        <a href="#">Decor</a>
        <a href="#">Bedding</a>
        <a href="#">Home Improvement</a>
        <a href="#">Kitchen</a>
        <a href="#">Lighting</a>
        <a href="#">Kids & Baby</a>
        <a href="#">Bath</a>
        <a href="#">More</a>
        <a href="#">Ideas</a>
        <a href="#">Sales & Deals</a>
       </div>
       <div id="spinner">
        <div class="spinner-inner"></div>
      </div>
      <br>
       <div class="container text-center">
        <div class="row">
          <div class="col-lg">
            <div id="container">
             
            </div>
          </div>
          <div class="col-lg">
            <div id="checkout" style="border:1px solid rgb(172, 170, 170);height: 80vh;overflow: hidden;padding: 1.5%;">
              <h3 style="text-align: center;overflow: hidden;color: rgb(148, 54, 207);">Check-Out</h3>
              <p><span class="left">Your current bill:</span><span class="right" id="span"></span></p>
              <p><span class="left">Discount:</span><span class="right" id="span">10%</span></p>
              <p><span class="left">Shipping Charges:</span><span class="right">₹ 0</span></p>
              <p><span class="left">Worker Charges:</span><span class="right">₹ 500</span></p>
              <hr>
              <p><span class="left">Total Bill:</span><span class="right" id="bill"></span></p>
              <br>
              <button id="check">proceed to checkout</button>
              <p style="color: #660033;">*Discount on purchase above 2 Lacs, *Shipping and Worker Charges extra</p>
             

            </div>
          </div>
          
        </div>
      </div>

      <div id="modal" style="display: none;" class="modal-dialog modal-dialog-centered">
          <h4>Purchase Complete!!! <span id="hurray">Hurray</span> </h4>
          <p style="font-size: 2rem;text-align: center;color:white">Your Total price is :₹<span id="mod"></span></p>
          <div id="tick" style="font-size: 10rem; text-align: center;margin-top: 10%;">
          &#9989;
          </div>
      </div>
      <br>
      <br>
      <footer>
        <div class="container text-center">
          <div class="row">
            <div class="col-md">
              <h4>My Account</h4>
                <ul>
                  <li>Orders</li>
                  <li>Email</li>
                  <li>Account</li>
                  
                </ul>
            </div>
            <div class="col-md">
              <h4>Let us help</h4>
              <ul>
                <li>Contact</li>
                <li>Customer Care</li>
                <li>Shoppping</li>
                <li>Return Policy</li>
                <li>Accessibility</li>
                
              </ul>
            </div>
            <div class="col-md">
              <h4>Let us help</h4>
              <ul>
                <li>Contact</li>
                <li>Customer Care</li>
                <li>Shoppping</li>
                <li>Return Policy</li>
                <li>Accessibility</li>
                
              </ul>
            </div>
            <div class="col-md">
              <h4>Let us help</h4>
              <ul>
                <li>Contact</li>
                <li>Customer Care</li>
                <li>Shoppping</li>
                <li>Return Policy</li>
                <li>Accessibility</li>
                
              </ul>
            </div>
          </div>
        </div>
       </footer>
    
    
      <section>
        &copy; Copyright 2023, FurnStock.com®, Inc.
      </section>
    
    
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>
<script>
  let baseserver = "https://uninterested-gray-dugong.cyclic.app"

  let container = document.getElementById("container")
  const spinner = document.getElementById("spinner")
  let span = document.getElementById("span")
  let bill = document.getElementById("bill")
  let btn = document.getElementById("check")
  let modal = document.getElementById("modal")
  let mod = document.getElementById("mod")

  btn.addEventListener("click",()=>{
     location.href = "./checkout.html"
  })



  window.addEventListener("load",()=>{
    fetched()
  })

  async function fetched() {
    spinner.style.display = "block"
   await  fetch(`${baseserver}/furnitre/`,{
    headers:{
      "Content-Type":"application/json",
      "Authorization":`Bearer ${localStorage.getItem("token")}`
    }
  })
  .then((res)=>res.json())
  .then((res)=>{
    spinner.style.display = "none"
    console.log(res)
    display(res)
  })
  .catch(err=>console.log(err))
  }

  function display(data) {
    if(data.length===0){
      btn.style.display = "none"
    }
    
    let totalPrice = 0;
    data.forEach(element => {
      const card = document.createElement("div")
          card.setAttribute("class","card")

          const itemPrice = element.cost * element.quantity; // calculate the price of this item
          totalPrice += itemPrice;

          const image = document.createElement("img")
          image.setAttribute("src",element.link)
          image.style.height = "40%"

          const cost  = document.createElement("p")
          cost.innerText = `INR ${element.cost}/-`
          cost.style.color = "red"
          cost.style.fontSize="1.2rem"
          
          const div = document.createElement("div")
          div.setAttribute("id","divs")
          div.style.display = "flex"
          div.style.justifyContent = "space-around"
          
          
          let quantity = document.createElement("p")
          quantity.innerText = `Quantity: ${Number(element.quantity)}`
          
          const increment = document.createElement("button")
          const decrement = document.createElement("button")
          const remove = document.createElement("button")
          
          increment.textContent = "+"
          decrement.textContent = "-"
          remove.textContent = "Remove"
          
          increment.style.width = "30%"
          increment.style.backgroundColor = "blue"
          increment.style.color = "white"
          increment.style.borderColor = "transparent"
          increment.style.borderRadius = "5px"
          decrement.style.width = "30%"
          decrement.style.backgroundColor = "blue"
          decrement.style.color = "white"
          decrement.style.borderColor = "transparent"
          decrement.style.borderRadius = "5px"
          increment.style.marginBottom = "5%"
          decrement.style.marginBottom = "5%"


          remove.style.backgroundColor = "red"
          remove.style.color = "white"
          remove.style.borderColor = "transparent"
          remove.style.width = "50%"
          remove.style.margin = "auto"


           //increment
         increment.addEventListener("click", () => {
  console.log("Before increment:", element.quantity);
  element.quantity++;
  console.log("After increment:", element.quantity);

  fetch(`${baseserver}/furnitre/update/${element._id}`, {
    method: "PATCH",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${localStorage.getItem("token")}`
    },
    body: JSON.stringify({
      quantity: element.quantity
    })
  })
  .then(res => res.json())
  .then(data => {
    console.log("Quantity updated in the backend:", data);

    fetched()
    location.reload()
  })
  .catch(err => console.log(err));
});


decrement.addEventListener("click", () => {
  console.log("Before increment:", element.quantity);
  element.quantity--;
  console.log("After increment:", element.quantity);

  fetch(`http://localhost:5050/furnitre/update/${element._id}`, {
    method: "PATCH",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${localStorage.getItem("token")}`
    },
    body: JSON.stringify({
      quantity: element.quantity
    })
  })
  .then(res => res.json())
  .then(data => {
    console.log("Quantity updated in the backend:", data);

    fetched()
    location.reload()
  })
  .catch(err => console.log(err));
});


remove.addEventListener("click", () => {
 

  fetch(`${baseserver}/furnitre/delete/${element._id}`, {
    method: "DELETE",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${localStorage.getItem("token")}`
    }
   
  })
  .then(res => res.json())
  .then(data => {
    console.log("Quantity deleted in the backend:", data);

    fetched()
    location.reload()
  })
  .catch(err => console.log(err));
});


         

        
           div.append(increment,decrement)
          card.append(image,cost,quantity,div,remove)
          container.append(card)



      });
      const total = document.createElement("p");
total.innerText = `₹ ${totalPrice}/-`;
span.append(total);

let bil;
if(totalPrice > 200000){
  totalPrice = totalPrice - (0.1)*totalPrice;
  bil =  500 + totalPrice;
}
else if(totalPrice ===0){
  bil = 0
} else {
  bil =  500 + totalPrice;
}

console.log(bil);
bill.innerText = `₹ ${bil}/-`;


  mod.innerText = bil
  console.log(mod.innerText)
 
     
  }
  if(localStorage.length>0){
    document.getElementById("logout").style.display = "block"
    document.getElementById("logout").style.border = "1px solid white"
   
    document.getElementById("logout").style.marginRight= "1.2%"
    document.getElementById("login").style.display = "none"
  }
  document.getElementById("logout").addEventListener("click",()=>{
    console.log("click")
    localStorage.clear()
   
  document.getElementById("logout").style.display = "none"
  login.style.display = "block"
   })

</script>
</html>